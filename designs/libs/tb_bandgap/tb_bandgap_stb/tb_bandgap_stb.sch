v {xschem version=3.4.7 file_version=1.2}
G {}
K {}
V {}
S {}
E {}
B 2 1570 -900 2370 -500 {flags=graph
y1=-540
y2=82
ypos1=0
ypos2=2
divy=5
subdivy=1
unity=1
x1=0
x2=10
divx=5
subdivx=8
xlabmag=1.0
ylabmag=1.0
dataset=0
unitx=1
logx=1
logy=0
rawfile=$netlist_dir/tb_bandgap_stb.raw
autoload=1
color="7 12"
node="\\"Magnitude;t db20()\\"
\\"Phase;ph(t) cph()\\""
}
N 1210 -470 1210 -350 {lab=vpref}
N 970 -530 970 -470 {lab=#net1}
N 970 -530 990 -530 {lab=#net1}
N 1210 -530 1210 -470 {lab=vpref}
N 1180 -530 1210 -530 {lab=vpref}
N 1050 -530 1120 -530 {lab=#net2}
N 1070 -530 1070 -510 {lab=#net2}
N 790 -350 790 -320 {lab=VSS}
N 790 -430 790 -410 {lab=VDD}
N 1210 -350 1240 -350 {lab=vpref}
N 970 -330 1240 -330 {lab=#net1}
N 970 -470 970 -330 {lab=#net1}
N 1320 -290 1340 -290 {lab=VSS}
N 1460 -390 1570 -390 {lab=VBG}
N 1570 -330 1570 -320 {lab=VSS}
N 1520 -410 1630 -410 {lab=VZTC}
N 1630 -350 1630 -340 {lab=VSS}
N 1420 -410 1520 -410 {lab=VZTC}
N 1430 -40 1430 -20 {lab=VSS}
N 1430 -70 1440 -70 {lab=VSS}
N 1440 -70 1440 -20 {lab=VSS}
N 1430 -20 1440 -20 {lab=VSS}
N 1390 -120 1390 -70 {lab=IZTC}
N 1390 -120 1430 -120 {lab=IZTC}
N 1430 -120 1430 -100 {lab=IZTC}
N 1430 -330 1430 -120 {lab=IZTC}
N 1530 -40 1530 -20 {lab=VSS}
N 1530 -70 1540 -70 {lab=VSS}
N 1540 -70 1540 -20 {lab=VSS}
N 1530 -20 1540 -20 {lab=VSS}
N 1490 -120 1490 -70 {lab=IPTAT}
N 1490 -120 1530 -120 {lab=IPTAT}
N 1530 -120 1530 -100 {lab=IPTAT}
N 1630 -40 1630 -20 {lab=VSS}
N 1630 -70 1640 -70 {lab=VSS}
N 1640 -70 1640 -20 {lab=VSS}
N 1630 -20 1640 -20 {lab=VSS}
N 1590 -120 1590 -70 {lab=ICTAT}
N 1590 -120 1630 -120 {lab=ICTAT}
N 1630 -120 1630 -100 {lab=ICTAT}
N 1420 -330 1430 -330 {lab=IZTC}
N 1420 -350 1480 -350 {lab=IPTAT}
N 1480 -350 1480 -140 {lab=IPTAT}
N 1480 -140 1530 -140 {lab=IPTAT}
N 1530 -140 1530 -120 {lab=IPTAT}
N 1420 -370 1500 -370 {lab=ICTAT}
N 1500 -370 1500 -160 {lab=ICTAT}
N 1500 -160 1630 -160 {lab=ICTAT}
N 1630 -160 1630 -120 {lab=ICTAT}
N 1420 -390 1460 -390 {lab=VBG}
N 1180 -840 1200 -840 {lab=VSS}
N 1320 -940 1430 -940 {lab=VBG_q}
N 1430 -880 1430 -870 {lab=VSS}
N 1380 -960 1490 -960 {lab=VZTC_q}
N 1490 -900 1490 -890 {lab=VSS}
N 1280 -960 1380 -960 {lab=VZTC_q}
N 1290 -590 1290 -570 {lab=VSS}
N 1290 -620 1300 -620 {lab=VSS}
N 1300 -620 1300 -570 {lab=VSS}
N 1290 -570 1300 -570 {lab=VSS}
N 1250 -670 1250 -620 {lab=IZTC_q}
N 1250 -670 1290 -670 {lab=IZTC_q}
N 1290 -670 1290 -650 {lab=IZTC_q}
N 1290 -880 1290 -670 {lab=IZTC_q}
N 1390 -590 1390 -570 {lab=VSS}
N 1390 -620 1400 -620 {lab=VSS}
N 1400 -620 1400 -570 {lab=VSS}
N 1390 -570 1400 -570 {lab=VSS}
N 1350 -670 1350 -620 {lab=IPTAT_q}
N 1350 -670 1390 -670 {lab=IPTAT_q}
N 1390 -670 1390 -650 {lab=IPTAT_q}
N 1490 -590 1490 -570 {lab=VSS}
N 1490 -620 1500 -620 {lab=VSS}
N 1500 -620 1500 -570 {lab=VSS}
N 1490 -570 1500 -570 {lab=VSS}
N 1450 -670 1450 -620 {lab=ICTAT_q}
N 1450 -670 1490 -670 {lab=ICTAT_q}
N 1490 -670 1490 -650 {lab=ICTAT_q}
N 1280 -880 1290 -880 {lab=IZTC_q}
N 1280 -900 1340 -900 {lab=IPTAT_q}
N 1340 -900 1340 -690 {lab=IPTAT_q}
N 1340 -690 1390 -690 {lab=IPTAT_q}
N 1390 -690 1390 -670 {lab=IPTAT_q}
N 1280 -920 1360 -920 {lab=ICTAT_q}
N 1360 -920 1360 -710 {lab=ICTAT_q}
N 1360 -710 1490 -710 {lab=ICTAT_q}
N 1490 -710 1490 -670 {lab=ICTAT_q}
N 1280 -940 1320 -940 {lab=VBG_q}
N 1100 -900 1100 -880 {lab=vpref_q}
C {devices/code_shown.sym} 0 -220 0 0 {name=MODELS only_toplevel=true
format="tcleval( @value )"
value="
.include $::180MCU_MODELS/design.ngspice
.lib $::180MCU_MODELS/sm141064.ngspice typical
.lib $::180MCU_MODELS/sm141064.ngspice res_typical
.lib $::180MCU_MODELS/sm141064.ngspice bjt_typical
.lib $::180MCU_MODELS/sm141064.ngspice moscap_typical
* .lib $::180MCU_MODELS/sm141064.ngspice res_statistical
"}
C {devices/code_shown.sym} 10 -630 0 0 {name=NGSPICE only_toplevel=true
value="
.param B=0
.control
save all
ac dec 100 1 10G
alterparam B=1
reset
ac dec 100 1 10G
setplot new
set curplottitle=Loopgain
let frequency=ac1.frequency
let T=(ac1.i(V3)+ ac2.i(V4))/(ac1.i(V4)+ ac2.i(V3))
let Tmag=db(T)
let Tphase=180*cph(T)/pi
*plot Tmag Tphase xlog
write tb_bandgap_stb.raw all
.endc
"}
C {vsource.sym} 1020 -530 3 0 {name=V4 
value="0 AC \{1-B\}"}
C {bsource.sym} 1070 -480 0 0 {name=B1 VAR=V FUNC="'V(vpref_q)'" m=1}
C {lab_pin.sym} 1070 -450 3 0 {name=p19 lab=VSS}
C {vsource.sym} 1150 -530 1 1 {name=V3 
value="0 AC \{B\}"}
C {launcher.sym} 1640 -960 0 0 {name=h5
descr="load waves" 
tclcommand="xschem raw_read $netlist_dir/tb_opamp_two_stage_stb_v2.raw tran"
}
C {launcher.sym} 90 -730 0 0 {name=h1
descr="Reference openloop analysis" 
url=https://youtu.be/BLXNkmubQzA?si=SPMKC-v-QuUZXauS}
C {vsource.sym} 790 -380 0 0 {name=V5 value=2 savecurrent=false}
C {lab_pin.sym} 790 -430 0 0 {name=p22 sig_type=std_logic lab=VDD}
C {lab_wire.sym} 790 -340 0 0 {name=p23 sig_type=std_logic lab=VSS}
C {vsource.sym} 790 -290 0 0 {name=VSS_sense1 value=0 savecurrent=false}
C {gnd.sym} 790 -260 0 0 {name=l2 lab=GND}
C {title.sym} 160 -40 0 0 {name=l6 author="Luighi Viton (AutoMOS-Project)"}
C {lab_pin.sym} 1320 -450 0 1 {name=p3 lab=VDD}
C {lab_pin.sym} 1420 -390 0 1 {name=p7 lab=VBG}
C {lab_pin.sym} 1320 -290 1 1 {name=p8 lab=VSS}
C {capa.sym} 1570 -360 0 0 {name=C1
m=1
value=100f
footprint=1206
device="ceramic capacitor"}
C {lab_pin.sym} 1570 -320 1 1 {name=p9 lab=VSS}
C {libs/core_bandgap/bandgap/bandgap.sym} 1260 -430 0 0 {name=xI_bandgap}
C {lab_wire.sym} 1210 -350 0 0 {name=p10 sig_type=std_logic lab=vpref}
C {lab_pin.sym} 1420 -350 0 1 {name=p11 lab=IPTAT}
C {lab_pin.sym} 1420 -330 0 1 {name=p12 lab=IZTC}
C {lab_pin.sym} 1420 -370 0 1 {name=p13 lab=ICTAT}
C {lab_pin.sym} 1420 -410 0 1 {name=p14 lab=VZTC}
C {capa.sym} 1630 -380 0 0 {name=C2
m=1
value=100f
footprint=1206
device="ceramic capacitor"}
C {lab_pin.sym} 1630 -340 1 1 {name=p15 lab=VSS}
C {symbols/nfet_05v0.sym} 1410 -70 0 0 {name=M1
L=2u
W=1u
nf=1
m=1
ad="'int((nf+1)/2) * W/nf * 0.18u'"
pd="'2*int((nf+1)/2) * (W/nf + 0.18u)'"
as="'int((nf+2)/2) * W/nf * 0.18u'"
ps="'2*int((nf+2)/2) * (W/nf + 0.18u)'"
nrd="'0.18u / W'" nrs="'0.18u / W'"
sa=0 sb=0 sd=0
model=nfet_05v0
spiceprefix=X
}
C {lab_wire.sym} 1430 -20 0 0 {name=p16 sig_type=std_logic lab=VSS}
C {symbols/nfet_05v0.sym} 1510 -70 0 0 {name=M2
L=2u
W=1u
nf=1
m=1
ad="'int((nf+1)/2) * W/nf * 0.18u'"
pd="'2*int((nf+1)/2) * (W/nf + 0.18u)'"
as="'int((nf+2)/2) * W/nf * 0.18u'"
ps="'2*int((nf+2)/2) * (W/nf + 0.18u)'"
nrd="'0.18u / W'" nrs="'0.18u / W'"
sa=0 sb=0 sd=0
model=nfet_05v0
spiceprefix=X
}
C {lab_wire.sym} 1530 -20 0 0 {name=p17 sig_type=std_logic lab=VSS}
C {symbols/nfet_05v0.sym} 1610 -70 0 0 {name=M3
L=2u
W=1u
nf=1
m=1
ad="'int((nf+1)/2) * W/nf * 0.18u'"
pd="'2*int((nf+1)/2) * (W/nf + 0.18u)'"
as="'int((nf+2)/2) * W/nf * 0.18u'"
ps="'2*int((nf+2)/2) * (W/nf + 0.18u)'"
nrd="'0.18u / W'" nrs="'0.18u / W'"
sa=0 sb=0 sd=0
model=nfet_05v0
spiceprefix=X
}
C {lab_wire.sym} 1630 -20 0 0 {name=p18 sig_type=std_logic lab=VSS}
C {lab_pin.sym} 1180 -1000 0 1 {name=p1 lab=VDD}
C {lab_pin.sym} 1280 -940 0 1 {name=p2 lab=VBG_q}
C {lab_pin.sym} 1180 -840 1 1 {name=p4 lab=VSS}
C {capa.sym} 1430 -910 0 0 {name=C3
m=1
value=100f
footprint=1206
device="ceramic capacitor"}
C {lab_pin.sym} 1430 -870 1 1 {name=p5 lab=VSS}
C {libs/core_bandgap/bandgap/bandgap.sym} 1120 -980 0 0 {name=xI_bandgap1}
C {lab_pin.sym} 1280 -900 0 1 {name=p6 lab=IPTAT_q}
C {lab_pin.sym} 1280 -880 0 1 {name=p20 lab=IZTC_q}
C {lab_pin.sym} 1280 -920 0 1 {name=p21 lab=ICTAT_q}
C {lab_pin.sym} 1280 -960 0 1 {name=p24 lab=VZTC_q}
C {capa.sym} 1490 -930 0 0 {name=C4
m=1
value=100f
footprint=1206
device="ceramic capacitor"}
C {lab_pin.sym} 1490 -890 1 1 {name=p25 lab=VSS}
C {symbols/nfet_05v0.sym} 1270 -620 0 0 {name=M4
L=2u
W=1u
nf=1
m=1
ad="'int((nf+1)/2) * W/nf * 0.18u'"
pd="'2*int((nf+1)/2) * (W/nf + 0.18u)'"
as="'int((nf+2)/2) * W/nf * 0.18u'"
ps="'2*int((nf+2)/2) * (W/nf + 0.18u)'"
nrd="'0.18u / W'" nrs="'0.18u / W'"
sa=0 sb=0 sd=0
model=nfet_05v0
spiceprefix=X
}
C {lab_wire.sym} 1290 -570 0 0 {name=p26 sig_type=std_logic lab=VSS}
C {symbols/nfet_05v0.sym} 1370 -620 0 0 {name=M5
L=2u
W=1u
nf=1
m=1
ad="'int((nf+1)/2) * W/nf * 0.18u'"
pd="'2*int((nf+1)/2) * (W/nf + 0.18u)'"
as="'int((nf+2)/2) * W/nf * 0.18u'"
ps="'2*int((nf+2)/2) * (W/nf + 0.18u)'"
nrd="'0.18u / W'" nrs="'0.18u / W'"
sa=0 sb=0 sd=0
model=nfet_05v0
spiceprefix=X
}
C {lab_wire.sym} 1390 -570 0 0 {name=p27 sig_type=std_logic lab=VSS}
C {symbols/nfet_05v0.sym} 1470 -620 0 0 {name=M6
L=2u
W=1u
nf=1
m=1
ad="'int((nf+1)/2) * W/nf * 0.18u'"
pd="'2*int((nf+1)/2) * (W/nf + 0.18u)'"
as="'int((nf+2)/2) * W/nf * 0.18u'"
ps="'2*int((nf+2)/2) * (W/nf + 0.18u)'"
nrd="'0.18u / W'" nrs="'0.18u / W'"
sa=0 sb=0 sd=0
model=nfet_05v0
spiceprefix=X
}
C {lab_wire.sym} 1490 -570 0 0 {name=p28 sig_type=std_logic lab=VSS}
C {lab_wire.sym} 1100 -900 0 0 {name=p29 sig_type=std_logic lab=vpref_q}
